<Window xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:avaloniaEdit="https://github.com/avaloniaui/avaloniaedit"
    xmlns:views="using:ScratchpadSharp.Views"
    xmlns:converters="using:ScratchpadSharp.Converters"
    xmlns:the="clr-namespace:TheArtOfDev.HtmlRenderer.Avalonia;assembly=Avalonia.HtmlRenderer"
    x:Class="ScratchpadSharp.Views.MainWindow"
    Title="ScratchpadSharp"
    Width="1200"
    Height="800"
    WindowStartupLocation="CenterScreen">

    <Window.KeyBindings>
        <KeyBinding Gesture="Ctrl+N" Command="{Binding NewCommand}" />
        <KeyBinding Gesture="Ctrl+O" Command="{Binding OpenCommand}" />
        <KeyBinding Gesture="Ctrl+S" Command="{Binding SaveCommand}" />
        <KeyBinding Gesture="Ctrl+Shift+S" Command="{Binding SaveAsCommand}" />
        <KeyBinding Gesture="Ctrl+Alt+F" Command="{Binding FormatCommand}" />
        <KeyBinding Gesture="F5" Command="{Binding ExecuteCommand}" />
        <KeyBinding Gesture="Shift+F5" Command="{Binding CancelCommand}" />
    </Window.KeyBindings>

    <Window.Resources>
        <converters:HighlightBoolConverter x:Key="HighlightBoolConverter" />
    </Window.Resources>

    <DockPanel LastChildFill="True">
        <!-- Menu -->
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="File">
                <MenuItem Header="New" Command="{Binding NewCommand}" InputGesture="Ctrl+N" />
                <MenuItem Header="Open" Command="{Binding OpenCommand}" InputGesture="Ctrl+O" />
                <MenuItem Header="Save" Command="{Binding SaveCommand}" InputGesture="Ctrl+S" />
                <MenuItem Header="Save As..." Command="{Binding SaveAsCommand}"
                    InputGesture="Ctrl+Shift+S" />
                <Separator />
                <MenuItem Header="Exit" Command="{Binding ExitCommand}" />
            </MenuItem>
            <MenuItem Header="Edit">
                <MenuItem Header="Format Document" Command="{Binding FormatCommand}" InputGesture="Ctrl+Shift+F" />
            </MenuItem>
            <MenuItem Header="Run">
                <MenuItem Header="Execute Script" Command="{Binding ExecuteCommand}"
                    InputGesture="F5" />
                <MenuItem Header="Cancel" Command="{Binding CancelCommand}" InputGesture="Shift+F5" />
            </MenuItem>
        </Menu>

        <!-- Status Bar -->
        <StackPanel DockPanel.Dock="Bottom" Orientation="Horizontal" Height="24"
            Background="#F0F0F0">
            <TextBlock Text="Ready" Foreground="#666666" Margin="8,4" />
            <TextBlock Margin="8,4,0,4" Text="{Binding StatusText}" Foreground="#666666" />
        </StackPanel>

        <!-- Main Content -->
        <Grid x:Name="MainGrid" RowDefinitions="*, Auto, 2*" Background="White">
            <!-- Code Editor -->
            <avaloniaEdit:TextEditor Grid.Row="0"
            Name="CodeEditor"
            FontFamily="JetBrains Mono, Cascadia Code, DejaVu Sans Mono, monospace"
            FontWeight="Medium"
            ShowLineNumbers="True"
            WordWrap="False"                
            IsReadOnly="False"
            MinHeight="200"
            IsVisible="True"
            IsEnabled="True"
            Focusable="True"
            HorizontalAlignment="Stretch"
            VerticalAlignment="Stretch" />

            <!-- Splitter -->
            <GridSplitter Grid.Row="1" Height="4" Background="#CCCCCC" />

            <!-- Results Panel -->
            <!-- Results Panel -->
            <Border Grid.Row="2" BorderThickness="0,1,0,0">
                <Grid RowDefinitions="Auto, *">
                    <Grid Grid.Row="0" ColumnDefinitions="*, Auto">
                        <TextBlock Grid.Column="0"
                            Text="Output"
                            FontWeight="Bold"
                            Padding="8,4" 
                            VerticalAlignment="Center"/>
                        <Button Grid.Column="1"
                            Command="{Binding ToggleOutputViewCommand}"
                            Content="{Binding ShowHtmlOutput, Converter={StaticResource HighlightBoolConverter}, ConverterParameter='HTML|Text'}" 
                            Margin="4"
                            Padding="8,2"/>
                    </Grid>
                    
                    <Panel Grid.Row="1">
                        <!-- HTML Output from Dumpify -->
                        <ScrollViewer IsVisible="{Binding ShowHtmlOutput}">
                             <the:HtmlPanel Text="{Binding HtmlOutput}" />
                        </ScrollViewer>
                        
                        <!-- Raw Text Output -->
                        <ScrollViewer IsVisible="{Binding !ShowHtmlOutput}">
                            <SelectableTextBlock Text="{Binding Output}"
                                FontFamily="Cascadia Code, Consolas, monospace"
                                Padding="8,4"
                                TextWrapping="Wrap" />
                        </ScrollViewer>
                    </Panel>
                </Grid>
            </Border>
        </Grid>
    </DockPanel>
</Window>