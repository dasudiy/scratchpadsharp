<UserControl xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:views="clr-namespace:ScratchpadSharp.Views"
    xmlns:converters="using:ScratchpadSharp.Converters"
    x:Class="ScratchpadSharp.Views.SignatureHelpPopup"
    Width="500"
    MaxWidth="700">

    <UserControl.Resources>
        <converters:HighlightBoolConverter x:Key="HighlightBoolConverter" />
    </UserControl.Resources>

    <Border Background="White" 
            BorderBrush="#CCCCCC" 
            BorderThickness="1" 
            CornerRadius="6" 
            BoxShadow="0 4 16 #00000030"
            Padding="0">
        
        <Grid RowDefinitions="Auto,*,Auto">
            
            <!-- 顶部工具栏 -->
            <Border Grid.Row="0" 
                    Background="#F8F9FA" 
                    BorderBrush="#E0E0E0" 
                    BorderThickness="0,0,0,1"
                    Padding="12,6"
                    IsVisible="{Binding HasMultipleSignatures}">
                <Grid ColumnDefinitions="*,Auto">
                    <TextBlock Grid.Column="0"
                               Text="{Binding SignatureCountText}"
                               FontSize="11"
                               Foreground="#666666"
                               VerticalAlignment="Center" />
                    <StackPanel Grid.Column="1" 
                                Orientation="Horizontal" 
                                Spacing="4">
                        <TextBlock Text="Use ↑↓ to navigate"
                                   FontSize="10"
                                   Foreground="#999999"
                                   VerticalAlignment="Center" />
                    </StackPanel>
                </Grid>
            </Border>

            <!-- 主内容区 -->
            <ScrollViewer Grid.Row="1" 
                          MaxHeight="300"
                          HorizontalScrollBarVisibility="Disabled"
                          VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="12" Spacing="10">
                    
                    <!-- 方法签名 -->
                    <StackPanel Spacing="4">
                        <!-- 返回类型和方法名 -->
                        <StackPanel Orientation="Horizontal" Spacing="4">
                            <!-- 扩展方法标记 -->
                            <Border Background="#E3F2FD" 
                                    CornerRadius="3"
                                    Padding="4,2"
                                    IsVisible="{Binding CurrentSignature.IsExtensionMethod}">
                                <TextBlock Text="extension" 
                                           FontSize="9"
                                           Foreground="#1976D2"
                                           FontWeight="Bold" />
                            </Border>
                            
                            <TextBlock Text="{Binding CurrentSignature.ReturnType}" 
                                       Foreground="#0066CC" 
                                       FontWeight="SemiBold" 
                                       FontSize="12"
                                       FontFamily="Cascadia Code, Consolas, monospace" />
                            <TextBlock Text=" " FontSize="12" />
                            <TextBlock Text="{Binding CurrentSignature.Name}" 
                                       FontWeight="Bold" 
                                       FontSize="12"
                                       FontFamily="Cascadia Code, Consolas, monospace" />
                            <TextBlock Text="(" 
                                       FontSize="12"
                                       FontFamily="Cascadia Code, Consolas, monospace" />
                        </StackPanel>

                        <!-- 参数列表 -->
                        <ItemsControl ItemsSource="{Binding CurrentSignature.Parameters}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" 
                                                Spacing="4" 
                                                Margin="24,2,0,2">
                                        
                                        <!-- params 关键字 -->
                                        <TextBlock Text="params "
                                                   Foreground="#0066CC"
                                                   FontFamily="Cascadia Code, Consolas, monospace"
                                                   FontSize="11"
                                                   IsVisible="{Binding IsParams}" />
                                        
                                        <!-- 参数类型 -->
                                        <TextBlock Text="{Binding Type}"
                                                   Foreground="{Binding IsHighlighted, 
                                                       Converter={StaticResource HighlightBoolConverter},
                                                       ConverterParameter=#1E90FF|#2E7D32}"
                                                   FontFamily="Cascadia Code, Consolas, monospace"
                                                   FontSize="11"
                                                   FontWeight="{Binding IsHighlighted, 
                                                       Converter={x:Static converters:BoldConverter.Instance}}" />
                                        
                                        <!-- 参数名 -->
                                        <TextBlock Text="{Binding Name}"
                                                   Foreground="{Binding IsHighlighted, 
                                                       Converter={StaticResource HighlightBoolConverter},
                                                       ConverterParameter=#1E90FF|#000000}"
                                                   FontFamily="Cascadia Code, Consolas, monospace"
                                                   FontSize="11"
                                                   FontWeight="SemiBold" />
                                        
                                        <!-- 默认值 -->
                                        <TextBlock IsVisible="{Binding IsOptional}">
                                            <Run Text=" = " />
                                            <Run Text="{Binding DefaultValue}" 
                                                 Foreground="#666666" />
                                        </TextBlock>
                                        
                                        <!-- 逗号 -->
                                        <TextBlock Text="," 
                                                   Foreground="#666666" 
                                                   FontFamily="Cascadia Code, Consolas, monospace"
                                                   FontSize="11"
                                                   IsVisible="{Binding !IsLast}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- 闭括号 -->
                        <TextBlock Text=")" 
                                   FontSize="12"
                                   FontFamily="Cascadia Code, Consolas, monospace" />
                    </StackPanel>

                    <!-- 分隔线 -->
                    <Border Height="1" 
                            Background="#E0E0E0"
                            Margin="0,4"
                            IsVisible="{Binding CurrentSignature.Summary, 
                                Converter={x:Static StringConverters.IsNotNullOrEmpty}}" />

                    <!-- 文档说明 -->
                    <StackPanel Spacing="8"
                                IsVisible="{Binding CurrentSignature.Summary, 
                                    Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                        
                        <!-- 摘要 -->
                        <TextBlock Text="{Binding CurrentSignature.Summary}"
                                   FontSize="11"
                                   Foreground="#333333"
                                   TextWrapping="Wrap"
                                   MaxWidth="450" />

                        <!-- 当前参数的文档 -->
                        <Border Background="#FFF9E6"
                                BorderBrush="#FFE082"
                                BorderThickness="1"
                                CornerRadius="4"
                                Padding="8"
                                IsVisible="{Binding CurrentParameterDocumentation, 
                                    Converter={x:Static StringConverters.IsNotNullOrEmpty}}">
                            <StackPanel Spacing="4">
                                <TextBlock Text="{Binding CurrentParameterName}"
                                           FontWeight="Bold"
                                           FontSize="10"
                                           Foreground="#F57C00"
                                           FontFamily="Cascadia Code, Consolas, monospace" />
                                <TextBlock Text="{Binding CurrentParameterDocumentation}"
                                           FontSize="10"
                                           Foreground="#555555"
                                           TextWrapping="Wrap" />
                            </StackPanel>
                        </Border>
                    </StackPanel>
                    
                </StackPanel>
            </ScrollViewer>

            <!-- 底部提示 -->
            <Border Grid.Row="2"
                    Background="#F8F9FA"
                    BorderBrush="#E0E0E0"
                    BorderThickness="0,1,0,0"
                    Padding="12,6">
                <TextBlock Text="Press Esc to dismiss"
                           FontSize="10"
                           Foreground="#999999"
                           HorizontalAlignment="Right" />
            </Border>
            
        </Grid>
    </Border>
</UserControl>
