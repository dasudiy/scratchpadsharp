<UserControl xmlns="https://github.com/avaloniaui"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:views="clr-namespace:ScratchpadSharp.Views"
    xmlns:converters="using:ScratchpadSharp.Converters"
    xmlns:vm="using:ScratchpadSharp.ViewModels"
    x:Class="ScratchpadSharp.Views.SignatureHelpPopup"
    Width="700"
    MaxHeight="200">

    <UserControl.Resources>
        <converters:HighlightBoolConverter x:Key="HighlightBoolConverter" />
    </UserControl.Resources>

    <Border Background="White" 
            BorderBrush="#CCCCCC" 
            BorderThickness="1" 
            CornerRadius="4" 
            BoxShadow="0 4 12 #00000020"
            Padding="0">
        
        <!-- Signature List Only -->
        <ListBox ItemsSource="{Binding Signatures}"
                 SelectedItem="{Binding SelectedSignature}"
                 Background="Transparent"
                 BorderThickness="0"
                 ScrollViewer.HorizontalScrollBarVisibility="Disabled">
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <StackPanel Spacing="2">
                        <!-- Top Row: Signature + Summary -->
                        <Grid ColumnDefinitions="Auto,*">
                            
                            <!-- Signature -->
                            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                                 <!-- Extension Badge -->
                                <Border Background="#E3F2FD" 
                                        CornerRadius="3"
                                        Padding="4,2"
                                        IsVisible="{Binding IsExtensionMethod}">
                                    <TextBlock Text="ext" 
                                               FontSize="9"
                                               Foreground="#1976D2"
                                               FontWeight="Bold" />
                                </Border>

                                <TextBlock Text="{Binding ReturnType}" 
                                           Foreground="#0000FF" 
                                           FontSize="11"
                                           FontFamily="Cascadia Code, Consolas, monospace" />
                                
                                <TextBlock Text="{Binding Name}" 
                                           FontWeight="Bold" 
                                           FontSize="11"
                                           FontFamily="Cascadia Code, Consolas, monospace" />
                                
                                <TextBlock Text="(" 
                                           FontSize="11"
                                           FontFamily="Cascadia Code, Consolas, monospace" />
                                           
                                <!-- Parameters -->
                                <ItemsControl ItemsSource="{Binding Parameters}">
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Horizontal" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                 <TextBlock Text="{Binding Type}"
                                                           Foreground="{Binding IsHighlighted, Converter={StaticResource HighlightBoolConverter}, ConverterParameter=#1E90FF|#666666}"
                                                           FontWeight="{Binding IsHighlighted, Converter={x:Static converters:BoldConverter.Instance}}"
                                                           FontSize="11"
                                                           FontFamily="Cascadia Code, Consolas, monospace"/>
                                                <TextBlock Text=" " FontSize="11"/>
                                                <TextBlock Text="{Binding Name}"
                                                           Foreground="{Binding IsHighlighted, Converter={StaticResource HighlightBoolConverter}, ConverterParameter=#1E90FF|#000000}"
                                                           FontWeight="{Binding IsHighlighted, Converter={x:Static converters:BoldConverter.Instance}}"
                                                           FontSize="11"
                                                           FontFamily="Cascadia Code, Consolas, monospace"/>
                                                <TextBlock Text=", " 
                                                           FontSize="11"
                                                           IsVisible="{Binding !IsLast}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                
                                <TextBlock Text=")" 
                                           FontSize="11"
                                           FontFamily="Cascadia Code, Consolas, monospace" />
                            </StackPanel>

                            <!-- Summary (Inline) -->
                            <TextBlock Grid.Column="1" 
                                       Text="{Binding Summary}"
                                       FontSize="11"
                                       Foreground="#888888"
                                       TextTrimming="CharacterEllipsis"
                                       Margin="12,0,0,0"
                                       VerticalAlignment="Center"
                                       IsVisible="{Binding Summary, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"/>
                        </Grid>

                        <!-- Bottom Row: Parameter Doc (Only if Best Match) -->
                        <TextBlock Text="{Binding CurrentParameterDocumentation}"
                                   FontSize="11"
                                   Foreground="#333333"
                                   TextWrapping="Wrap"
                                   Margin="20,2,0,4"
                                   IsVisible="{Binding IsBestMatch}" />
                    </StackPanel>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
    </Border>
</UserControl>
